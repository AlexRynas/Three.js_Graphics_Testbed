<section class="testbed">
  <header class="topbar">
    <div class="brand">
      <span class="title">Graphics Testbed</span>
      <span class="subtitle">Angular 21 + Three.js</span>
    </div>
    <div class="top-actions">
      <button appPillButton type="button" (click)="runBenchmark()">Run benchmark</button>
      <button appPillButton type="button" variant="ghost" (click)="exportMetrics()">
        Export metrics
      </button>
      <button appPillButton type="button" variant="ghost" (click)="toggleGui()">Toggle GUI</button>
    </div>
  </header>

  <main class="layout">
    <div class="viewport" #viewport>
      <canvas #canvas class="render-canvas" aria-label="3D render viewport"></canvas>
      <app-hud-list class="hud" [rows]="hudRows()"></app-hud-list>
      <div class="status-bar">
        <span>{{ status() }}</span>
        @if (benchmark().active) {
          <span class="status-chip"
            >Benchmark {{ benchmark().progress * 100 | number: '1.0-0' }}%</span
          >
        }
      </div>
    </div>

    <aside appPanel>
      <section class="panel-section">
        <h3 appSectionHeader>Collections</h3>
        <div class="button-grid">
          @for (collection of collections(); track collection.id) {
            <button
              appSelectButton
              type="button"
              (click)="selectCollection(collection.id)"
              [active]="collection.id === activeCollectionId()"
            >
              <span>{{ collection.displayName }}</span>
            </button>
          }
        </div>
      </section>

      <section class="panel-section">
        <h3 appSectionHeader>Presets</h3>
        <div class="preset-list">
          @for (preset of presets(); track preset.name) {
            <div class="preset-row">
              <button appSelectButton type="button" (click)="applyPreset(preset)">
                <span>{{ preset.name }}</span>
              </button>
              <button
                appIconButton
                type="button"
                (click)="deletePreset(preset)"
                aria-label="Delete preset"
              >
                âœ•
              </button>
            </div>
          }
        </div>
        <label appLabeledField label="Preset name">
          <input
            class="field-input"
            type="text"
            [value]="presetName()"
            (input)="updatePresetName($event)"
            placeholder="Name your preset"
          />
        </label>
        <button appPillButton type="button" (click)="savePreset()">Save preset</button>
      </section>

      <section class="panel-section">
        <h3 appSectionHeader>Capabilities</h3>
        <app-stat-grid [rows]="capabilityRows()"></app-stat-grid>
      </section>

      <section class="panel-section">
        <h3 appSectionHeader>Scene Inspector</h3>
        <app-stat-grid [rows]="inspectorRows()"></app-stat-grid>
      </section>

      <section class="panel-section">
        <h3 appSectionHeader>Feature Toggles</h3>
        <div class="feature-list">
          @for (feature of featureRows(); track feature.key) {
            <div class="feature-row" [class.unsupported]="!feature.supported">
              <span>{{ feature.label }}</span>
              <span class="feature-status">
                {{ feature.supported ? 'Supported' : 'Unavailable' }}
              </span>
            </div>
          }
        </div>
        <p class="hint">Use the lil-gui panel for detailed sliders and quality controls.</p>
      </section>
    </aside>
  </main>

  <div class="gui-dock" #guiHost [class.hidden]="!guiVisible()"></div>
</section>
