<aside
  appPanel
  class="settings-dock"
  aria-labelledby="settings-dock-title"
  aria-label="Scene and rendering controls"
>
  <h3 id="settings-dock-title" appSectionHeader>Render Settings</h3>

  <section class="group" aria-label="Display and renderer settings">
    <h4 class="group-title">Display + Renderer</h4>

    <label appLabeledField label="Mode">
      <select
        #rendererMode
        class="field-input"
        (change)="updateRendererMode(rendererMode.value)"
      >
        @for (mode of rendererModes; track mode) {
          <option [value]="mode" [selected]="settings().rendererMode === mode">
            {{ mode.toUpperCase() }}
          </option>
        }
      </select>
    </label>

    <label appLabeledField label="Tone mapping">
      <select
        #toneMapping
        class="field-input"
        (change)="updateToneMapping(toneMapping.value)"
      >
        @for (mode of toneMappingModes; track mode) {
          <option [value]="mode" [selected]="sceneSettings().toneMapping === mode">
            {{ mode.toUpperCase() }}
          </option>
        }
      </select>
    </label>

    @if (showExposure()) {
      <label appLabeledField label="Exposure">
        <div class="range-field">
          <input
            #exposure
            class="field-input"
            type="range"
            min="0.4"
            max="2"
            step="0.05"
            [value]="sceneSettings().exposure"
            (input)="updateSceneNumber('exposure', exposure.valueAsNumber)"
          />
          <span class="range-value">{{ sceneSettings().exposure.toFixed(2) }}</span>
        </div>
      </label>
    }
  </section>

  @if (showRasterControls()) {
    <section class="group" aria-label="Anti-aliasing settings">
      <h4 class="group-title">Anti-Aliasing</h4>

    <label appLabeledField label="Anti-aliasing">
      <select
        #antialiasing
        class="field-input"
        (change)="updateAntialiasing(antialiasing.value)"
      >
        @for (mode of antialiasingModes; track mode) {
          <option
            [value]="mode"
            [selected]="settings().antialiasing === mode"
            [disabled]="!isAntialiasingSupported(mode)"
          >
            {{ mode.toUpperCase() }}
          </option>
        }
      </select>
    </label>

    @if (showSmaaQuality()) {
      <label appLabeledField label="SMAA quality">
        <select
          #smaaQuality
          class="field-input"
          [disabled]="!isControlSupported('smaaQuality')"
          (change)="updateSmaaQuality(smaaQuality.value)"
        >
          @for (quality of qualityLevels; track quality) {
            <option [value]="quality" [selected]="settings().smaaQuality === quality">
              {{ quality.toUpperCase() }}
            </option>
          }
        </select>
      </label>
    }

    @if (showTaaSamples()) {
      <label appLabeledField label="TAA samples">
        <div class="range-field">
          <input
            #taaSamples
            class="field-input"
            type="range"
            min="1"
            max="8"
            step="1"
            [value]="settings().taaSamples"
            [disabled]="!isControlSupported('taaSamples')"
            (input)="updateRenderingNumber('taaSamples', taaSamples.valueAsNumber)"
          />
          <span class="range-value">{{ settings().taaSamples }}</span>
        </div>
      </label>
    }
    </section>
  }

  @if (showRasterControls()) {
    <section class="group" aria-label="Shadows and occlusion settings">
      <h4 class="group-title">Shadows + Occlusion</h4>

    <label appLabeledField label="Shadow type">
      <select #shadowType class="field-input" (change)="updateShadowType(shadowType.value)">
        @for (mode of shadowTypes; track mode) {
          <option [value]="mode" [selected]="settings().shadowType === mode">
            @if (mode === 'pcfSoft') {
              PCF Soft
            } @else {
              {{ mode.toUpperCase() }}
            }
          </option>
        }
      </select>
    </label>

    <label class="toggle-row">
      <span>Contact shadows</span>
      <input
        #contactShadows
        type="checkbox"
        [checked]="settings().contactShadows"
        (change)="updateRenderingBoolean('contactShadows', contactShadows.checked)"
      />
    </label>

    <label class="toggle-row">
      <span>GTAO</span>
      <input
        #gtaoEnabled
        type="checkbox"
        [checked]="settings().gtaoEnabled"
        [disabled]="!isControlSupported('gtaoEnabled')"
        (change)="updateRenderingBoolean('gtaoEnabled', gtaoEnabled.checked)"
      />
    </label>

    @if (showGtaoChildren()) {
      <label appLabeledField label="GTAO radius">
        <div class="range-field">
          <input
            #gtaoRadius
            class="field-input"
            type="range"
            min="1"
            max="32"
            step="1"
            [value]="settings().gtaoRadius"
            [disabled]="!isControlSupported('gtaoRadius')"
            (input)="updateRenderingNumber('gtaoRadius', gtaoRadius.valueAsNumber)"
          />
          <span class="range-value">{{ settings().gtaoRadius }}</span>
        </div>
      </label>

      <label appLabeledField label="GTAO quality">
        <select
          #gtaoQuality
          class="field-input"
          [disabled]="!isControlSupported('gtaoQuality')"
          (change)="updateGtaoQuality(gtaoQuality.value)"
        >
          @for (quality of qualityLevels; track quality) {
            <option [value]="quality" [selected]="settings().gtaoQuality === quality">
              {{ quality.toUpperCase() }}
            </option>
          }
        </select>
      </label>
    }
    </section>
  }

  @if (showPostProcessingControls()) {
    <section class="group" aria-label="Reflections and camera effects settings">
      <h4 class="group-title">Reflections + Camera FX</h4>

    <label class="toggle-row" [class.disabled-row]="!isControlSupported('ssrEnabled')">
      <span>SSR</span>
      <input
        #ssrEnabled
        type="checkbox"
        [checked]="settings().ssrEnabled"
        [disabled]="!isControlSupported('ssrEnabled')"
        (change)="updateRenderingBoolean('ssrEnabled', ssrEnabled.checked)"
      />
    </label>
    <p class="feature-note">{{ getControlHint('ssrEnabled') ?? 'SSR availability depends on active renderer implementation.' }}</p>

    <label class="toggle-row" [class.disabled-row]="!isControlSupported('globalIllumination')">
      <span>Global illumination</span>
      <input
        #globalIllumination
        type="checkbox"
        [checked]="settings().globalIllumination"
        [disabled]="!isControlSupported('globalIllumination')"
        (change)="updateRenderingBoolean('globalIllumination', globalIllumination.checked)"
      />
    </label>
    <p class="feature-note">{{ getControlHint('globalIllumination') ?? 'Global illumination is available only on the WebGPU renderer.' }}</p>

    <label class="toggle-row">
      <span>Depth of field</span>
      <input
        #depthOfField
        type="checkbox"
        [checked]="settings().depthOfField"
        [disabled]="!isControlSupported('depthOfField')"
        (change)="updateRenderingBoolean('depthOfField', depthOfField.checked)"
      />
    </label>

    @if (showDofChildren()) {
      <label appLabeledField label="DOF focus">
        <div class="range-field">
          <input
            #dofFocus
            class="field-input"
            type="range"
            min="1"
            max="20"
            step="0.1"
            [value]="settings().dofFocus"
            [disabled]="!isControlSupported('dofFocus')"
            (input)="updateRenderingNumber('dofFocus', dofFocus.valueAsNumber)"
          />
          <span class="range-value">{{ settings().dofFocus.toFixed(1) }}</span>
        </div>
      </label>

      <label appLabeledField label="DOF aperture">
        <div class="range-field">
          <input
            #dofAperture
            class="field-input"
            type="range"
            min="0.001"
            max="0.05"
            step="0.001"
            [value]="settings().dofAperture"
            [disabled]="!isControlSupported('dofAperture')"
            (input)="updateRenderingNumber('dofAperture', dofAperture.valueAsNumber)"
          />
          <span class="range-value">{{ settings().dofAperture.toFixed(3) }}</span>
        </div>
      </label>

      <label appLabeledField label="DOF blur">
        <div class="range-field">
          <input
            #dofBlur
            class="field-input"
            type="range"
            min="0.001"
            max="0.02"
            step="0.001"
            [value]="settings().dofMaxBlur"
            [disabled]="!isControlSupported('dofMaxBlur')"
            (input)="updateRenderingNumber('dofMaxBlur', dofBlur.valueAsNumber)"
          />
          <span class="range-value">{{ settings().dofMaxBlur.toFixed(3) }}</span>
        </div>
      </label>
    }

    <label class="toggle-row">
      <span>Vignette</span>
      <input
        #vignette
        type="checkbox"
        [checked]="settings().vignette"
        [disabled]="!isControlSupported('vignette')"
        (change)="updateRenderingBoolean('vignette', vignette.checked)"
      />
    </label>

    <label class="toggle-row">
      <span>Film grain</span>
      <input
        #filmGrain
        type="checkbox"
        [checked]="settings().filmGrain"
        [disabled]="!isControlSupported('filmGrain')"
        (change)="updateRenderingBoolean('filmGrain', filmGrain.checked)"
      />
    </label>
    </section>
  }

  <section class="group" aria-label="Ray/Path tracing settings">
    <h4 class="group-title">Ray/Path tracing</h4>

    <label class="toggle-row disabled-row">
      <span>Ray tracing</span>
      <input type="checkbox" [checked]="settings().rayTracing" disabled />
    </label>
    <p class="feature-note">No ready-made NPM package currently provides an out-of-the-box Three.js ray tracing implementation; manual integration would take significant engineering time.</p>

    <label class="toggle-row" [class.disabled-row]="!isWebglMode()">
      <span>Path tracing</span>
      <input
        #pathTracing
        type="checkbox"
        [checked]="settings().pathTracing"
        [disabled]="!isWebglMode()"
        (change)="updateRenderingBoolean('pathTracing', pathTracing.checked)"
      />
    </label>

    @if (!isWebglMode()) {
      <p class="feature-note">Path tracing is available only with the WebGL renderer.</p>
    }

    @if (isPathTracingEnabled()) {
      <label appLabeledField label="Bounces">
        <div class="range-field">
          <input
            #ptBounces
            class="field-input"
            type="range"
            min="1"
            max="12"
            step="1"
            [value]="settings().pathTracingBounces"
            (input)="updateRenderingNumber('pathTracingBounces', ptBounces.valueAsNumber)"
          />
          <span class="range-value">{{ settings().pathTracingBounces }}</span>
        </div>
      </label>

      <label appLabeledField label="Min samples">
        <div class="range-field">
          <input
            #ptMinSamples
            class="field-input"
            type="range"
            min="1"
            max="12"
            step="1"
            [value]="settings().pathTracingMinSamples"
            (input)="updateRenderingNumber('pathTracingMinSamples', ptMinSamples.valueAsNumber)"
          />
          <span class="range-value">{{ settings().pathTracingMinSamples }}</span>
        </div>
      </label>

      <label appLabeledField label="Render scale">
        <div class="range-field">
          <input
            #ptRenderScale
            class="field-input"
            type="range"
            min="0.25"
            max="1"
            step="0.05"
            [value]="settings().pathTracingRenderScale"
            (input)="updateRenderingNumber('pathTracingRenderScale', ptRenderScale.valueAsNumber)"
          />
          <span class="range-value">{{ settings().pathTracingRenderScale.toFixed(2) }}</span>
        </div>
      </label>

      <label appLabeledField label="Tiles">
        <div class="range-field">
          <input
            #ptTiles
            class="field-input"
            type="range"
            min="1"
            max="6"
            step="1"
            [value]="settings().pathTracingTiles"
            (input)="updateRenderingNumber('pathTracingTiles', ptTiles.valueAsNumber)"
          />
          <span class="range-value">{{ settings().pathTracingTiles }}</span>
        </div>
      </label>

      <label class="toggle-row">
        <span>Dynamic low-res</span>
        <input
          #ptDynamicLowRes
          type="checkbox"
          [checked]="settings().pathTracingDynamicLowRes"
          (change)="updateRenderingBoolean('pathTracingDynamicLowRes', ptDynamicLowRes.checked)"
        />
      </label>

      <label appLabeledField label="Low-res scale">
        <div class="range-field">
          <input
            #ptLowResScale
            class="field-input"
            type="range"
            min="0.1"
            max="1"
            step="0.05"
            [value]="settings().pathTracingLowResScale"
            (input)="updateRenderingNumber('pathTracingLowResScale', ptLowResScale.valueAsNumber)"
          />
          <span class="range-value">{{ settings().pathTracingLowResScale.toFixed(2) }}</span>
        </div>
      </label>

      <label appLabeledField label="Filter glossy">
        <div class="range-field">
          <input
            #ptFilterGlossy
            class="field-input"
            type="range"
            min="0"
            max="1"
            step="0.05"
            [value]="settings().pathTracingFilterGlossyFactor"
            (input)="updateRenderingNumber('pathTracingFilterGlossyFactor', ptFilterGlossy.valueAsNumber)"
          />
          <span class="range-value">{{ settings().pathTracingFilterGlossyFactor.toFixed(2) }}</span>
        </div>
      </label>

      <label class="toggle-row">
        <span>Denoiser</span>
        <input
          #ptDenoiser
          type="checkbox"
          [checked]="settings().pathTracingDenoiserEnabled"
          (change)="updateRenderingBoolean('pathTracingDenoiserEnabled', ptDenoiser.checked)"
        />
      </label>

      @if (settings().pathTracingDenoiserEnabled) {
        <label appLabeledField label="Denoiser sigma">
          <div class="range-field">
            <input
              #ptDenoiserSigma
              class="field-input"
              type="range"
              min="0.5"
              max="16"
              step="0.5"
              [value]="settings().pathTracingDenoiserSigma"
              (input)="updateRenderingNumber('pathTracingDenoiserSigma', ptDenoiserSigma.valueAsNumber)"
            />
            <span class="range-value">{{ settings().pathTracingDenoiserSigma.toFixed(1) }}</span>
          </div>
        </label>

        <label appLabeledField label="Denoiser threshold">
          <div class="range-field">
            <input
              #ptDenoiserThreshold
              class="field-input"
              type="range"
              min="0.001"
              max="0.2"
              step="0.001"
              [value]="settings().pathTracingDenoiserThreshold"
              (input)="updateRenderingNumber('pathTracingDenoiserThreshold', ptDenoiserThreshold.valueAsNumber)"
            />
            <span class="range-value">{{ settings().pathTracingDenoiserThreshold.toFixed(3) }}</span>
          </div>
        </label>
      }
    }
  </section>

  @if (showRasterControls()) {
    <section class="group" aria-label="Texture settings">
      <h4 class="group-title">Textures</h4>

    <label appLabeledField label="Filtering">
      <select
        #filtering
        class="field-input"
        (change)="updateTextureFiltering(filtering.value)"
      >
        @for (mode of textureModes; track mode) {
          <option [value]="mode" [selected]="settings().textureFiltering === mode">
            {{ mode.toUpperCase() }}
          </option>
        }
      </select>
    </label>

    @if (showAnisotropy()) {
      <label appLabeledField label="Anisotropy">
        <div class="range-field">
          <input
            #anisotropy
            class="field-input"
            type="range"
            min="1"
            [max]="capabilities().maxAnisotropy || 1"
            step="1"
            [value]="settings().anisotropy"
            (input)="updateRenderingNumber('anisotropy', anisotropy.valueAsNumber)"
          />
          <span class="range-value">{{ settings().anisotropy }}</span>
        </div>
      </label>
    }
    </section>
  }

  <section class="group" aria-label="Scene behavior settings">
    <h4 class="group-title">Scene Behavior</h4>

    <label appLabeledField label="Environment intensity">
      <div class="range-field">
        <input
          #environmentIntensity
          class="field-input"
          type="range"
          min="0"
          max="2"
          step="0.05"
          [value]="sceneSettings().environmentIntensity"
          (input)="updateSceneNumber('environmentIntensity', environmentIntensity.valueAsNumber)"
        />
        <span class="range-value">{{ sceneSettings().environmentIntensity.toFixed(2) }}</span>
      </div>
    </label>

    <label class="toggle-row">
      <span>Environment map</span>
      <input
        #environmentMapEnabled
        type="checkbox"
        [checked]="sceneSettings().environmentMapEnabled"
        (change)="updateSceneBoolean('environmentMapEnabled', environmentMapEnabled.checked)"
      />
    </label>

    <label class="toggle-row">
      <span>Auto-rotate camera</span>
      <input
        #autoRotate
        type="checkbox"
        [checked]="sceneSettings().autoRotate"
        (change)="updateSceneBoolean('autoRotate', autoRotate.checked)"
      />
    </label>

    <label appLabeledField label="LOD bias">
      <div class="range-field">
        <input
          #lodBias
          class="field-input"
          type="range"
          min="-2"
          max="2"
          step="0.25"
          [value]="sceneSettings().lodBias"
          (input)="updateSceneNumber('lodBias', lodBias.valueAsNumber)"
        />
        <span class="range-value">{{ sceneSettings().lodBias.toFixed(2) }}</span>
      </div>
    </label>

    <label class="toggle-row" [class.disabled-row]="isPathTracingEnabled()">
      <span>GPU BVH</span>
      <input
        #bvhEnabled
        type="checkbox"
        [checked]="sceneSettings().bvhEnabled"
        [disabled]="isPathTracingEnabled()"
        (change)="updateSceneBoolean('bvhEnabled', bvhEnabled.checked)"
      />
    </label>

    @if (isPathTracingEnabled()) {
      <p class="feature-note">GPU BVH is a raster raycast-acceleration toggle and is ignored in path tracing mode.</p>
    }
  </section>
</aside>